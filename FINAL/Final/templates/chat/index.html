{% extends "base_chat.html" %}

{% block content %}
    <h1>채팅방 목록</h1>
    <ul>
        {% for room in room_list %}
            <li>
                <a href="{% url 'chat:room_chat' room.pk %}" class="protected-link">
                    {{ room.name }}
                </a>
            </li>
        {% endfor %}
    </ul>   
    <a href="{% url 'chat:room_new' %}" class="protected-link">
        새 채팅방 만들기
    </a>

    <!-- 로그인 모달 -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <p class="close">&times;</p>
            <center>
                <h2>로그인 필요</h2>
                <p>이 작업을 수행하려면 로그인이 필요합니다.</p>
                <a href="/users/login/" class="login-button">로그인</a>
                <a href="/chat/">목록으로 이동합니다</a>
                <p></p>
            </center>
        </div>
    </div>

    <style>
        /* 모달 스타일 */
        .modal {
            display: none; 
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 10px;
            border: 5px solid #888;
            width: 30%;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 20px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>

    <script>
       const userId = "{{ user.username|default:0 }}";
        // 로그인 여부 확인 함수
        function checkLogin(event) {
            // 유저 아이디가 없으면 로그인되지 않은 것으로 간주
            if (!userId || userId == 0) {
                // 로그인되지 않은 경우 모달 창 표시
                event.preventDefault();
                document.getElementById('loginModal').style.display = 'block';
            }
        }

        // 모든 링크에 대해 클릭 이벤트 리스너 추가
        document.querySelectorAll('.protected-link').forEach(function(link) {
            link.addEventListener('click', checkLogin);
        });

        // 모달 닫기 버튼 클릭 시 모달 숨김
        document.querySelector('.close').onclick = function() {
            document.getElementById('loginModal').style.display = 'none';
        };

        // 모달 외부 클릭 시 모달 숨김
        window.onclick = function(event) {
            if (event.target == document.getElementById('loginModal')) {
                document.getElementById('loginModal').style.display = 'none';
            }
        };
    </script>
{% endblock %}
