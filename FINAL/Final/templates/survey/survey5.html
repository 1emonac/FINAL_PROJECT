{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="{% static 'css/survey5.css' %}" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <a id="nucubuc" title="Follow me on Twitter" target="_blank">
        <div class="symbol">
          <div></div>
          <div></div>
          <div></div>
          <div></div>
        </div>
        <svg version="1.1" viewBox="0 0 84 84">
          <path class="mouth" d="M12,43c23.6,6.9,43.6,4.6,60-7">
            <animate attributeName="d" fill="freeze" dur="500ms" calcMode="spline" keySplines="0.190 1.000 0.220 1.000" keyTimes="0;1"></animate>
          </path>
          <g class="eyes">
            <path class="leftEye" d="M12,32c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C10,31.1,10.9,32,12,32">
              <animate attributeName="d" fill="freeze" dur="500ms" calcMode="spline" keySplines="0.190 1.000 0.220 1.000" keyTimes="0;1"></animate>
            </path>
            <path class="rightEye" d="M60,32c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C58,31.1,58.9,32,60,32">
              <animate attributeName="d" fill="freeze" dur="500ms" calcMode="spline" keySplines="0.190 1.000 0.220 1.000" keyTimes="0;1"></animate>
            </path>
          </g>
        </svg>
    </a>

    <div class="question-wrapper">
        <div class="question current" id="question1">
            <div class="small spans">Question 01</div>
            <ul class="question">
                <li class="spans">어제 밤 잠을 잘 주무셨나요?</li>
            </ul>
            <div class="answer">
                <div class="range">
                    <input type="range" name="feeling1" value="2" min="1" max="2"/>
                    <ul>
                        <li>네</li>
                        <li>아니오</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="question" id="question2">
            <div class="small spans">Question 02</div>
            <ul class="question">
                <li class="spans">스트레스를 얼만큼 받으셨나요?</li>
            </ul>
            <div class="answer">
                <div class="range">
                    <input type="range" name="feeling2" value="4" min="1" max="5"/>
                    <ul>
                        <li>매우 많이</li>
                        <li>꽤 많이</li>
                        <li>평소와 같음</li>
                        <li>별로 안 받음</li>
                        <li>전혀 안 받음</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="question" id="question3">
            <div class="small spans">Question 03</div>
            <ul class="question">
                <li class="spans">Overall, how are you feeling about</li>
                <li class="spans">the universe?</li>
            </ul>
            <div class="answer">
                <div class="range">
                    <input type="range" name="feeling3" value="4" min="1" max="5"/>
                    <ul>
                        <li>Bad</li>
                        <li>Unhappy</li>
                        <li>Natural</li>
                        <li>Satisfied</li>
                        <li>Amazed</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // REACTIONS
        var reactions = [
        {
            name: 'Bad',
            mouth: 'M17,73c-3.3-18,22.8-14.7,31,0',
            leftEye: 'M15,58c0.6,0,1-0.4,1-1c0-0.6-0.4-1-1-1s-1,0.4-1,1C14,57.6,14.4,58,15,58',
            rightEye: 'M25,55c0.6,0,1-0.4,1-1c0-0.6-0.4-1-1-1s-1,0.4-1,1C24,54.6,24.4,55,25,55' },
        {
            name: 'Unhappy',
            mouth: 'M12,57c15.8-10.5,35.8-12.8,60-7',
            leftEye: 'M22,41c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C20,40.1,20.9,41,22,41',
            rightEye: 'M55,39c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C53,38.1,53.9,39,55,39' },
        {
            name: 'Natural',
            mouth: 'M12,51c20-2.3,40-4.6,60-7',
            leftEye: 'M17,39c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C15,38.1,15.9,39,17,39',
            rightEye: 'M59,37c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C57,36.1,57.9,37,59,37' },
        {
            name: 'Satisfied',
            mouth: 'M12,43c23.6,6.9,43.6,4.6,60-7',
            leftEye: 'M12,32c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C10,31.1,10.9,32,12,32',
            rightEye: 'M60,32c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C58,31.1,58.9,32,60,32' },
        {
            name: 'Amazed',
            mouth: 'M12,45c10.9,29.4,48.7,26.7,60-15',
            leftEye: 'M14,25c1.1,0,2-2.2,2-5c0-2.8-0.9-5-2-5s-2,2.2-2,5C12,22.8,12.9,25,14,25',
            rightEye: 'M62,29c1.1,0,2-2.2,2-5c0-2.8-0.9-5-2-5s-2,2.2-2,5C60,26.8,60.9,29,62,29' }
        ];

        //  CHANGE REACTIONS
        function changeReactions(value) {
            var reaction = reactions[value - 1];
            var mouth = $('#nucubuc .mouth');
            var leftEye = $('#nucubuc .leftEye');
            var rightEye = $('#nucubuc .rightEye');

            function createAnimation(obj, to) {
                var animate = obj.find('animate');
                animate.attr({
                    from: obj.attr('d'),
                    to: to
                });

                animate[0].beginElement();
                obj.attr('d', to);
            }

            createAnimation(mouth, reaction.mouth);
            createAnimation(leftEye, reaction.leftEye);
            createAnimation(rightEye, reaction.rightEye);
        }

        //  DOCUMENT READY
        $(document).ready(function () {
            //  SPANS
            var paragraphs = $('.spans');

            paragraphs.each(function() {
                var paragraph = $(this);
                var spans = paragraph.text().split(' ');
                paragraph.empty();

                $.each(spans, function (i, span) {
                    paragraph.append($('<span>').text(span));
                });
            });

            //  RANGE
            var range = $('.range');

            //  CHANGE RANGE FUNCTION
            function changeRange(that, init) {
                var input, current, labels;

                input = $(that);
                if (init) input = $(that).find('input[type=range]');

                current = input.val();
                labels = input.siblings('ul');

                labels.children().removeClass('current');
                labels.children(':nth-child(' + current + ')').addClass('current');

                // 다음 질문으로 넘어가는 로직 추가
                var currentQuestion = $(that).closest('.question');
                var nextQuestion = currentQuestion.next('.question');

                if (!init && nextQuestion.length > 0) {
                    currentQuestion.removeClass('current');
                    nextQuestion.addClass('current');
                }
            }

            //  SET LISTENERS
            range.find('input[type=range]').on('change', function () {
                changeRange(this, false);
                changeReactions($(this).val());
            });

            // FAKE LOADER
            setTimeout(function () {
                $('.question').first().addClass('current');
                changeReactions($('.question.current input[type=range]').val());
            }, 1000);

            setTimeout(function () {
                range.each(function() {
                    changeRange(this, true);
                });
            }, 1150);
        });
    </script>
</body>
</html>
